{% extends 'core/base.html' %}
{% load static %}
{% block title %}Iniciar sesión{% endblock %}

{% block content %}
<style>
  .errorlist {
    color: red;
  }

  /* Texto mostrar contraseña */
  .toggle-password {
    font-size: 0.9rem;
    color: #0d6efd;
    cursor: pointer;
    user-select: none;
    display: inline-block;
    margin-top: 5px;
  }

  .toggle-password:hover {
    text-decoration: underline;
  }
</style>

<main role="main">
  <div class="container">
    <div class="row mt-3">
      <div class="col-md-9 mx-auto mb-5">

        {% if 'register' in request.GET %}
          <p style="color: green;">Usuario registrado correctamente</p>
        {% endif %}

        <form action="" method="post">
          {% csrf_token %}

          <h3 class="mb-4">Iniciar sesión</h3>

          {% if form.non_field_errors %}
            <p style="color:red">
              Usuario o contraseña incorrectos, prueba de nuevo.
            </p>
          {% endif %}

          <!-- Usuario (siempre en minúsculas) -->
          <p>
            <input
              type="text"
              name="username"
              autofocus
              maxlength="254"
              required
              id="id_username"
              class="form-control"
              placeholder="Nombre de usuario"
            />
          </p>

          <!-- Contraseña -->
          <p>
            <input
              type="password"
              name="password"
              required
              id="id_password"
              class="form-control"
              placeholder="Contraseña"
            />

            <span
              class="toggle-password"
              onclick="togglePassword()"
              id="toggleText"
            >
              Mostrar contraseña
            </span>
          </p>

          <!-- Botón -->
          <p>
            <input
              type="submit"
              class="btn btn-primary btn-block"
              value="Acceder"
            >
          </p>

        </form>

        <p>
          ¿Ha olvidado su clave?
          <a href="{% url 'password_reset' %}">
            Puede restaurarla aquí.
          </a>
        </p>

      </div>
    </div>
  </div>
</main>

<script>
  // Mostrar / ocultar contraseña
  function togglePassword() {
    const passwordInput = document.getElementById("id_password");
    const toggleText = document.getElementById("toggleText");

    if (passwordInput.type === "password") {
      passwordInput.type = "text";
      toggleText.textContent = "Ocultar contraseña";
    } else {
      passwordInput.type = "password";
      toggleText.textContent = "Mostrar contraseña";
    }
  }

  // Convertir username a minúsculas en tiempo real
  document.getElementById("id_username").addEventListener("input", function () {
    this.value = this.value.toLowerCase();
  });
</script>
{% endblock %}
